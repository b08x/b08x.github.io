# _includes/ - Reusable Jekyll Partials

14 include files across 3 subdirectories. Mix of modern Tailwind and legacy CSS variable patterns.

## STRUCTURE

```
_includes/
├── terminal-header.html    # Site header with nav + theme toggle (29 LOC)
├── terminal-sidebar.html   # Recent notes navigation (43 LOC)
├── footer.html             # Minimal footer text (2 LOC)
├── nav.html                # Alternate simple nav (4 LOC)
├── head.html               # Full <head> tag for standalone layouts
├── theme-toggle-button.html # Dark/light mode button (18 LOC)
├── link-previews.html      # Link preview popups
├── react_graph.html        # GraphView island markup
├── notes_graph.json        # Generated by bidirectional_links_generator.rb
│
├── page_sidebar/           # Right sidebar widgets (LEGACY STYLES)
│   ├── toc.html            # Table of contents (56 LOC) ⚠️ Legacy CSS
│   ├── media_widgets.html  # Audio/video widgets (149 LOC) ⚠️ Legacy CSS  
│   └── references.html     # Source references (110 LOC) ⚠️ Legacy CSS
│
└── jcanvas/                # Canvas-specific includes
    ├── head.html           # Canvas page head
    ├── nav.html            # Canvas navigation
    └── 404.html            # Canvas 404 page
```

## USAGE MAP

| Include | Used By | Purpose |
|---------|---------|---------|
| `terminal-header.html` | base-shell | Site header, primary nav, theme toggle |
| `terminal-sidebar.html` | terminal-layout | Left sidebar recent notes list |
| `footer.html` | base-shell | Site footer content |
| `theme-toggle-button.html` | terminal-header, nav | Sun/moon toggle button |
| `page_sidebar/toc.html` | terminal-layout | Right sidebar TOC (legacy) |
| `page_sidebar/media_widgets.html` | terminal-layout | Audio/video in sidebar |
| `page_sidebar/references.html` | terminal-layout | Reference links sidebar |
| `head.html` | canvas, canvas-home | Full HTML head for standalone |
| `jcanvas/*` | docs | Canvas documentation system |

## CSS VARIABLE INCONSISTENCIES

**Modern Tailwind Pattern (terminal-header, terminal-sidebar):**
```css
color: var(--foreground);
background: var(--surface);
border-color: var(--border);
/* Used via Tailwind: text-foreground, bg-surface, border-border */
```

**Legacy Pattern (page_sidebar/*):**
```css
color: var(--text-muted);        /* Should be: var(--muted) */
color: var(--text-secondary);    /* Should be: var(--foreground) with opacity */
color: var(--text-primary);      /* Should be: var(--foreground) */
background: var(--bg-surface);   /* Should be: var(--surface) */
background: var(--bg-secondary); /* Should be: var(--surface) */
border-color: var(--border-primary); /* Should be: var(--border) */
```

## WHERE TO LOOK

| Task | File | Notes |
|------|------|-------|
| Change site header | `terminal-header.html` | Nav items from `site.data.navigation.primary` |
| Add nav items | `_data/navigation.yml` | Define primary nav links |
| Modify sidebar notes | `terminal-sidebar.html` | Shows recent 15 notes |
| Fix TOC styling | `page_sidebar/toc.html` | Needs CSS variable update |
| Add audio widget | `page_sidebar/media_widgets.html` | Requires `page.audio_file` |
| Add video widget | `page_sidebar/media_widgets.html` | Requires `page.videos` array |
| Add references | `page_sidebar/references.html` | Requires `page.sources` array |

## CONVENTIONS

**Include with Parameters:**
```liquid
{% include page_sidebar/toc.html %}
```

**Conditional Includes in Layouts:**
```liquid
{% if page.right_sidebar contains 'toc' %}
  {% include page_sidebar/toc.html %}
{% endif %}
```

**Front-Matter Triggers:**
```yaml
# For media_widgets.html
audio_file: /assets/audio/guide.mp3
audio_timestamps:
  - time: "0:30"
    description: "Introduction"
videos:
  - title: "Tutorial"
    embed_id: "dQw4w9WgXcQ"
    platform: "youtube"

# For references.html
sources:
  - title: "Documentation"
    url: "https://example.com"
    type: "documentation"  # or: website, article, github
```

## ANTI-PATTERNS

- **NEVER** add new includes using legacy CSS variables (`--text-primary`, `--bg-secondary`, etc.)
- **AVOID** inline styles with JavaScript `onmouseover`/`onmouseout` (see terminal-sidebar.html:25-26)
- **AVOID** hardcoded colors in SVG icons
- **AVOID** FontAwesome classes (`fa-*`) in new includes - use inline SVG

## UNIFICATION NEEDS

### 1. page_sidebar/* CSS Variable Migration

**Current (toc.html:18-26):**
```css
#toc-list a {
  color: var(--text-muted);
  ...
}
#toc-list a:hover {
  color: var(--text-accent);
  background: var(--bg-surface);
}
```

**Should Be:**
```css
#toc-list a {
  color: var(--muted);  /* or use Tailwind: @apply text-muted */
  ...
}
#toc-list a:hover {
  color: var(--accent);
  background: var(--surface);
}
```

### 2. Inline Style Removal (terminal-sidebar.html)

**Current (lines 14-26):** JavaScript-based hover effects with inline styles

**Should Be:** Pure CSS with Tailwind classes:
```html
<a href="..." class="block py-2 px-3 text-sm border-l-2 
   border-transparent text-foreground/75
   hover:border-border hover:bg-surface hover:text-foreground
   data-[active]:border-accent data-[active]:bg-accent/10 data-[active]:text-accent">
```

### 3. TOC Component Consolidation

Two TOC implementations exist:
1. `page_sidebar/toc.html` - Legacy include with custom CSS
2. `<terminal-toc>` - Web component in `assets/js/components/terminal-toc.js`

**Recommendation:** Deprecate the include, use `<terminal-toc>` everywhere.

## DATA DEPENDENCIES

| Include | Requires Data From |
|---------|-------------------|
| `terminal-header.html` | `site.data.navigation.primary`, `site.github_url` |
| `terminal-sidebar.html` | `site.notes` collection |
| `notes_graph.json` | Auto-generated by `bidirectional_links_generator.rb` |
| `page_sidebar/toc.html` | Populated by JavaScript from page headings |
| `page_sidebar/media_widgets.html` | `page.audio_file`, `page.audio_timestamps`, `page.videos` |
| `page_sidebar/references.html` | `page.sources` |
