---
layout: base-shell
---

{% assign container_width = page.container_max_width | default: "mx-auto" %}
{% unless container_width contains 'max-w-' %}
{% if page.layout == 'wiki' or page.layout == 'wiki-page' %}
{% assign container_width = container_width | append: " max-w-notebook" %}
{% elsif page.right_sidebar %}
{% assign container_width = container_width | append: " max-w-notebook" %}
{% else %}
{% assign container_width = container_width | append: " max-w-content-2col" %}
{% endif %}
{% endunless %}

<div class="{{ container_width }} px-4 sm:px-6 lg:px-8 py-10">

  <!-- Responsive Grid Container -->
  <div class="flex flex-col lg:flex-row gap-8">

    <!-- Left Sidebar (Optional) -->
    {% if page.left_sidebar %}
    <aside id="left-sidebar" class="w-full lg:w-64 lg:flex-shrink-0" aria-label="Navigation sidebar">
      <div class="lg:sticky lg:top-8 lg:self-start">

        {% if page.left_sidebar == 'wiki-nav' %}
        <!-- Wiki Navigation Pattern -->
        <h3 class="text-xs font-bold uppercase tracking-wider mb-4 text-foreground/80">
          Wiki Pages
        </h3>
        <nav>
          <ul class="space-y-1">
            {% assign wiki_id = page.wiki_id %}
            {% assign wiki_data = site.data.wikis[wiki_id] %}
            {% for wp in wiki_data.pages %}
            <li>
              <a href="{{ site.baseurl }}{{ wp.generated_permalink }}"
                class="block py-2 px-3 text-sm border-l-2 {% if page.page_id == wp.id %}border-accent bg-surface/50 text-accent{% else %}border-transparent text-foreground/75{% endif %} transition-all hover:bg-surface hover:border-accent wiki-nav-link"
                data-page-id="{{ wp.id }}">
                {% if wp.number %}{{ wp.number }}_{% endif %}{{ wp.slug }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </nav>

        <div class="mt-12 pt-6 border-t border-border">
          <a href="{{ site.baseurl }}/"
            class="block text-sm font-mono text-foreground/70 hover:text-accent transition-colors">
            ‚Üê Back to Garden
          </a>
        </div>
        {% endif %}

        {% if page.left_sidebar == 'terminal-sidebar' %}
        <!-- Standard Navigation Sidebar -->
        <h3 class="text-xs font-bold uppercase tracking-wider mb-4 text-foreground/80">
          Navigation
        </h3>
        {% include terminal-sidebar.html %}
        {% endif %}

        {% if page.left_sidebar == 'knowledgebase-toc' %}
        <!-- Knowledgebase TOC -->
        <h3 class="text-xs font-bold uppercase tracking-wider mb-6 text-foreground/80">
          Knowledgebase
        </h3>
        <nav id="kb-toc" class="space-y-2">
          <!-- Dynamically populated by JS -->
        </nav>

        {% if page.resources %}
        <div class="mt-10 pt-10 border-t border-border">
          <h4 class="text-xs font-bold uppercase tracking-wider mb-4 text-foreground/80">
            Resources
          </h4>
          <div class="space-y-4">
            {% for item in page.resources %}
            <div class="flex items-center gap-2 text-sm">
              <svg class="w-4 h-4 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
              </svg>
              <a href="{{ item.url }}" class="text-foreground/75 hover:text-accent transition-colors">
                {{ item.title }}
              </a>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
        {% endif %}

      </div>
    </aside>
    {% endif %}

    <!-- Main Content Column -->
    {% assign content_width = page.content_max_width | default: "max-w-content" %}
    <main id="main-content-column" class="flex-1 min-w-0 {{ content_width }}" aria-label="Main content">

      <!-- Page Header -->
      {% unless page.hide_header %}
      <header class="mb-12">
        <h1 class="text-3xl md:text-4xl font-prose font-bold mb-4 text-foreground">
          {{ page.title }}
        </h1>

        {% if page.subtitle %}
        <h2 class="text-xl md:text-2xl font-prose font-bold mb-4 text-foreground">
          {{ page.subtitle }}
        </h2>
        {% endif %}

        {% if page.tags and page.tags.size > 0 %}
        <div class="mt-3 mb-3 flex flex-wrap gap-2">
          {% for tag in page.tags %}
          <span class="px-2 py-1 text-xs border border-border bg-surface rounded">
            {{ tag }}
          </span>
          {% endfor %}
        </div>
        {% endif %}

        <!-- Metadata (Conditional) -->
        {% if page.show_metadata != false %}
        <div class="text-md font-mono text-foreground/70">
          {% if page.last_modified_at %}
          <time datetime="{{ page.last_modified_at | date_to_xmlschema }}" class="inline-block mr-4">
            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            Last Modified: {{ page.last_modified_at | date: "%Y-%m-%d %I:%M:%S %p" }}
          </time>
          {% endif %}

        </div>
        {% endif %}
      </header>
      {% endunless %}

      <!-- Article Content -->
      <article class="prose font-prose max-w-none">
        <div id="notes-entry-container">
          {{ content }}
        </div>
      </article>

      <!-- React Island: GraphView (Conditional) -->
      {% assign show_graph = page.show_graph %}
      {% if show_graph == nil %}{% assign show_graph = layout.show_graph %}{% endif %}

      {% if show_graph %}
      <section class="mt-16 pt-10 border-t border-border">
        <h2 class="text-xl font-mono font-bold mb-6 text-foreground">
          Knowledge Graph
        </h2>
        <p class="mb-6 text-base font-prose text-foreground/80">
          Here are all the notes in this garden, along with their links, visualized as a graph.
        </p>
        <div data-island="GraphView"></div>
      </section>
      {% endif %}

    </main>

    <!-- Right Sidebar (Optional) -->
    {% if page.right_sidebar %}
    <aside id="right-sidebar"
      class="w-full lg:w-80 lg:flex-shrink-0 {% if page.right_sidebar_xl_only %}hidden xl:block{% endif %}"
      aria-label="Table of contents and related content">
      <div class="lg:sticky lg:top-8 lg:self-start space-y-10">

        {% if page.right_sidebar contains 'toc' %}
        <!-- Table of Contents -->
        <div>
          <h3 class="text-xs font-bold uppercase tracking-wider mb-4 text-foreground/80">
            Table of Contents
          </h3>
          <terminal-toc></terminal-toc>
        </div>
        {% endif %}

        {% if page.right_sidebar contains 'related' %}
        <!-- Related Pages -->
        <div>
          <h3 class="text-xs font-bold uppercase tracking-wider mb-4 text-foreground/80">
            Related Notes
          </h3>
          <div class="space-y-2">
            <!-- Dynamically populated -->
          </div>
        </div>
        {% endif %}

        {% if page.right_sidebar contains 'media' %}
        <!-- Media Widgets -->
        {% include page_sidebar/media_widgets.html %}
        {% endif %}

        {% if page.right_sidebar contains 'references' %}
        <!-- References -->
        {% include page_sidebar/references.html %}
        {% endif %}

      </div>
    </aside>
    {% endif %}

  </div>

</div>

<!-- Web Component: Terminal TOC -->
<script src="{{ site.baseurl }}/assets/js/components/terminal-toc.js" defer></script>

<!-- Wiki Navigation Active State Script -->
{% if page.layout == 'wiki' or page.layout == 'wiki-page' %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const navLinks = document.querySelectorAll(".wiki-nav-link");
    const currentUrl = window.location.pathname;

    navLinks.forEach(link => {
      if (link.getAttribute('href') === currentUrl || (link.getAttribute('href') + '/') === currentUrl) {
        link.classList.add("border-accent", "bg-surface/50", "text-accent");
        link.classList.remove("border-transparent", "text-foreground/75");
      }
    });

    // Handle single-page wiki sections if applicable
    const sections = document.querySelectorAll("section[id]");
    if (sections.length > 0) {
      function updateActiveLinkOnScroll() {
        let current = "";
        sections.forEach((section) => {
          const sectionTop = section.offsetTop;
          if (window.pageYOffset >= sectionTop - 150) {
            current = section.getAttribute("id");
          }
        });

        navLinks.forEach((link) => {
          const href = link.getAttribute("href");
          if (href.startsWith("#")) {
            link.classList.remove("border-accent", "bg-surface/50", "text-accent");
            link.classList.add("border-transparent", "text-foreground/75");

            if (href.slice(1) === current) {
              link.classList.remove("border-transparent", "text-foreground/75");
              link.classList.add("border-accent", "bg-surface/50", "text-accent");
            }
          }
        });
      }
      window.addEventListener("scroll", updateActiveLinkOnScroll);
      updateActiveLinkOnScroll();
    }
  });
</script>
{% endif %}

<!-- Knowledgebase TOC Integration (if knowledgebase layout) -->
{% if page.left_sidebar == 'knowledgebase-toc' %}
<link rel="stylesheet" href="{{ '/assets/css/knowledgebase.css' | relative_url }}">
<script>
  // Knowledgebase TOC Integration Script
  // Dynamically generates TOC from carousel slides and syncs with active slide

  document.addEventListener('DOMContentLoaded', () => {
    const tocContainer = document.getElementById('kb-toc');
    if (!tocContainer) return;

    // Generate TOC when slides are ready
    window.addEventListener('kb-slides-ready', (e) => {
      const { slides } = e.detail;

      // Clear existing TOC
      tocContainer.innerHTML = '';

      // Generate TOC links
      slides.forEach((slide, index) => {
        const link = document.createElement('a');
        link.href = `#${slide.id}`;
        link.className = 'kb-nav-link block py-2 px-3 text-sm border-l-2 border-transparent text-foreground/75 transition-all hover:bg-surface hover:border-accent';
        link.textContent = slide.title;
        link.dataset.slideIndex = String(index);

        // Handle click to navigate to slide
        link.addEventListener('click', (event) => {
          event.preventDefault();
          window.dispatchEvent(new CustomEvent('kb-toc-click', {
            detail: { slideIndex: index, slideId: slide.id }
          }));
        });

        tocContainer.appendChild(link);
      });
    });

    // Update TOC active state when slide changes
    window.addEventListener('kb-slide-change', (e) => {
      const { slideIndex } = e.detail;

      // Update TOC link active states
      const tocLinks = tocContainer.querySelectorAll('.kb-nav-link');
      tocLinks.forEach((link, index) => {
        if (index === slideIndex) {
          link.classList.add('border-accent', 'text-accent', 'bg-surface', 'font-semibold');
          link.classList.remove('border-transparent', 'text-muted');
        } else {
          link.classList.remove('border-accent', 'text-accent', 'bg-surface', 'font-semibold');
          link.classList.add('border-transparent', 'text-foreground/75');
        }
      });
    });
  });
</script>
{% endif %}


</body>

</html>