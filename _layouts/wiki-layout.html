---
layout: base-shell
---

<!-- Wiki Layout Container -->
<!-- Removed .container class to avoid conflicting max-widths. Using custom centering. -->
<div class="w-full max-w-[1800px] mx-auto px-4 sm:px-6 lg:px-8 py-10">

    <!-- Responsive Grid Container -->
    <div class="flex flex-col lg:flex-row gap-8">

        <!-- Left Sidebar (Wiki Navigation) -->
        <aside id="wiki-sidebar" class="w-full lg:w-64 lg:flex-shrink-0" aria-label="Wiki navigation">
            <div class="lg:sticky lg:top-8 lg:self-start">

                <h3 class="text-xs font-bold uppercase tracking-wider mb-4 text-foreground/80">
                    Wiki Pages
                </h3>

                {% if page.wiki_id %}
                <nav>
                    <ul class="space-y-1">
                        {% assign wiki_id = page.wiki_id %}
                        {% assign wiki_data = site.data.wikis[wiki_id] %}
                        {% for wp in wiki_data.pages %}
                        <li>
                            <a href="{{ site.baseurl }}/wikis/{{ wiki_id }}/{{ wp.id | slugify }}/"
                                class="block py-2 px-3 text-sm border-l-2 {% if page.page_id == wp.id %}border-accent bg-surface/50 text-accent{% else %}border-transparent text-foreground/75{% endif %} transition-all hover:bg-surface hover:border-accent wiki-nav-link"
                                data-page-id="{{ wp.id }}">
                                {{ wp.title }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </nav>
                {% endif %}

                <div class="mt-12 pt-6 border-t border-border">
                    <a href="{{ site.baseurl }}/"
                        class="block text-sm font-mono text-foreground/70 hover:text-accent transition-colors">
                        ‚Üê Back to Garden
                    </a>
                </div>

            </div>
        </aside>

        <!-- Main Content Column -->
        <main id="main-content-column" class="flex-1 min-w-0 max-w-none" aria-label="Main content">

            <!-- Page Header -->
            {% unless page.hide_header %}
            <header class="mb-12">
                <h1 class="text-3xl md:text-4xl font-prose font-bold mb-4 text-foreground">
                    {{ page.title }}
                </h1>

                <!-- Metadata -->
                {% if page.show_metadata != false %}
                <div class="text-sm font-mono text-foreground/70">
                    {% if page.last_modified_at %}
                    <time datetime="{{ page.last_modified_at | date_to_xmlschema }}" class="inline-block mr-4">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        {{ page.last_modified_at | date: "%Y-%m-%d" }}
                    </time>
                    {% endif %}
                </div>
                {% endif %}
            </header>
            {% endunless %}

            <!-- Content -->
            <article class="prose font-prose max-w-none">
                <div id="wiki-entry-container">
                    {{ content }}
                </div>
            </article>

            <!-- Graph View (Optional) -->
            {% if page.show_graph %}
            <section class="mt-16 pt-10 border-t border-border">
                <h2 class="text-xl font-mono font-bold mb-6 text-foreground">
                    Knowledge Graph
                </h2>
                <div data-island="GraphView"></div>
            </section>
            {% endif %}

        </main>

        <!-- Right Sidebar (TOC) -->
        <aside id="right-sidebar" class="w-full lg:w-64 lg:flex-shrink-0 hidden xl:block"
            aria-label="Table of contents">
            <div class="lg:sticky lg:top-8 lg:self-start">
                {% if page.toc != false %}
                <h3 class="text-xs font-bold uppercase tracking-wider mb-4 text-foreground/80">
                    Table of Contents
                </h3>
                <terminal-toc></terminal-toc>
                {% endif %}
            </div>
        </aside>

    </div>
</div>

<!-- Scripts -->
<script src="{{ site.baseurl }}/assets/js/components/terminal-toc.js" defer></script>
<script>
    // Active state for wiki nav
    document.addEventListener("DOMContentLoaded", () => {
        const navLinks = document.querySelectorAll(".wiki-nav-link");
        const currentUrl = window.location.pathname;

        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentUrl) {
                link.classList.add("border-accent", "bg-surface/50", "text-accent");
                link.classList.remove("border-transparent", "text-foreground/75");
            }
        });
    });
</script>