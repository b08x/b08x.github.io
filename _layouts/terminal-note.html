<!DOCTYPE html>
<html lang="en">
{% include head.html %}

<body class="max-w-none m-0 p-0 h-screen flex flex-col bg-background text-foreground font-mono antialiased">

  <!-- #container -->
  <div id="container" class="w-full flex flex-col min-h-screen">

    <!-- #header -->
    <header id="header" class="flex-none border-b" style="border-color: var(--border);">
      {% include terminal-header.html %}
    </header>

    <!-- Flex Wrapper for Columns -->
    <div class="flex-grow flex flex-col lg:flex-row gap-8 py-10 container mx-auto max-w-screen-xl px-4 sm:px-6 lg:px-8">

      <!-- #content -->
      <main id="content" class="flex-1 min-w-0">

        <!-- Article Header -->
        <header class="mb-12">
          <h1 class="text-3xl md:text-4xl font-prose font-bold mb-4" style="color: var(--foreground);">
            {{ page.title }}
          </h1>

          <!-- Metadata -->
          <div class="text-sm font-mono metadata" style="color: var(--muted);">
            {% if page.last_modified_at %}
            <time datetime="{{ page.last_modified_at | date_to_xmlschema }}" class="inline-block mr-4">
              <svg class="w-4 h-4 inline mr-1" width="16" height="16" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              {{ page.last_modified_at | date: "%Y-%m-%d" }}
            </time>
            {% endif %}

            {% if page.tags and page.tags.size > 0 %}
            <div class="mt-3 flex flex-wrap gap-2">
              {% for tag in page.tags %}
              <span class="px-2 py-1 text-xs border"
                style="background-color: var(--surface); border-color: var(--border);">
                {{ tag }}
              </span>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </header>

        <!-- Article Content -->
        <article class="prose font-prose max-w-none">
          <div id="notes-entry-container">
            {{ content }}
          </div>
        </article>

        <!-- Notes Graph Section -->
        {% if page.type != 'pages' %}
        <section class="mt-16 pt-10 border-t" style="border-color: var(--border);">
          <h2 class="text-xl font-mono font-bold mb-6" style="color: var(--foreground);">
            Knowledge Graph
          </h2>
          <p class="mb-6 text-base font-prose" style="color: var(--muted);">
            Here are all the notes in this garden, along with their links, visualized as a graph.
          </p>
          {% include react_graph.html %}
        </section>
        {% endif %}

      </main>

      <!-- #sidebar -->
      <aside id="sidebar" class="w-full lg:w-80 lg:flex-shrink-0 flex flex-col gap-10">

        <!-- Navigation Sidebar (Integrated) -->
        <div class="hidden lg:block">
          <h3 class="text-xs font-bold uppercase tracking-wider mb-4" style="color: var(--muted);">Navigation</h3>
          {% include terminal-sidebar.html %}
        </div>

        <!-- Table of Contents -->
        <div class="sticky top-8">
          <h3 class="text-xs font-bold uppercase tracking-wider mb-4" style="color: var(--muted);">Table of Contents
          </h3>
          <terminal-toc></terminal-toc>
        </div>

      </aside>

    </div>

    <!-- #footer -->
    <footer id="footer" class="flex-none py-8 border-t px-4 sm:px-6 lg:px-8" style="border-color: var(--border);">
      {% include footer.html %}
    </footer>

  </div>

  <!-- Web Component for TOC -->
  <script src="{{ site.baseurl }}/assets/js/components/terminal-toc.js" defer></script>

  <!-- Garden Widgets (React Islands) -->
  <div data-island="SearchCmdK"></div>
  <script src="{{ '/assets/js/dist/garden-widgets.js' | relative_url }}"></script>

  <!-- Code Block Copy Buttons -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll("pre code").forEach((codeBlock) => {
        const pre = codeBlock.parentElement;
        if (pre.querySelector(".copy-btn")) return;

        if (!pre.parentElement.classList.contains("code-block")) {
          const wrapper = document.createElement("div");
          wrapper.className = "code-block relative";
          wrapper.style.backgroundColor = "var(--bg-code)";
          wrapper.style.borderRadius = "0.5rem";
          wrapper.style.padding = "1.5rem";
          pre.parentElement.insertBefore(wrapper, pre);
          wrapper.appendChild(pre);
        }

        const button = document.createElement("button");
        button.className = "copy-btn absolute top-2 right-2 px-3 py-1 rounded text-xs font-mono";
        button.style.backgroundColor = "var(--surface)";
        button.style.color = "var(--foreground)";
        button.style.border = "1px solid var(--border)";
        button.textContent = "Copy";

        button.addEventListener("click", () => {
          const code = codeBlock.textContent;
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = "Copied!";
            button.style.color = "var(--accent)";
            setTimeout(() => {
              button.textContent = "Copy";
              button.style.color = "var(--foreground)";
            }, 2000);
          });
        });

        pre.parentElement.appendChild(button);
      });
    });
  </script>

</body>

</html>