# Syncopated Notes

A hybrid digital garden built with **Jekyll** (Static) and **React** (Interactive Islands), featuring a dark terminal aesthetic and bidirectional linking for knowledge management.

![Terminal Theme](https://img.shields.io/badge/theme-dark%20terminal-ff6600)
![Jekyll](https://img.shields.io/badge/jekyll-4.3+-red)
![React](https://img.shields.io/badge/react-19-61DAFB)
![esbuild](https://img.shields.io/badge/build-esbuild-FFCF00)
![Tailwind CSS](https://img.shields.io/badge/tailwind-4.x-38bdf8)

## ğŸ—ï¸ Architecture: The Static-Dynamic Hybrid

This project implements a **progressive enhancement architecture** using the "Islands" pattern, balancing static-first rendering with selective client-side interactivity.

### Core Philosophy

**Static-First Foundation (Jekyll)**
- All content, navigation, and layouts are pre-rendered at build time to static HTML
- 100% SEO-friendly with zero JavaScript required for content consumption
- Fast initial page loads with no client-side framework overhead
- Works perfectly with JavaScript disabled

**Dynamic Islands (React)**
- Interactive widgets are **selectively hydrated** on demand
- Each island is an isolated React component that mounts into a `data-island` element
- Islands share no state with each other, maintaining independence and reducing bundle size
- Uses **React 19** with Suspense for lazy-loading components

### Available Islands

| Island | Purpose | Data Source | Location |
|--------|---------|-------------|----------|
| `GraphView` | Interactive D3.js force-directed knowledge graph | `/graph.json` | `src/components/GraphView.tsx` |
| `SearchCmdK` | Global fuzzy search with `Cmd+K` shortcut | `/search.json` | `src/components/SearchCmdK.tsx` |
| `VideoPlayer` | Custom video player with controls | Props (inline) | `src/components/VideoPlayer.tsx` |
| `NotesGrid` | Filterable grid of notes/projects | Props (inline) | `src/components/NotesGrid.tsx` |
| `AudioPlayer` | Audio playback component | Props (inline) | `src/components/AudioPlayer.tsx` |
| `NotebookGuide` | Jupyter notebook navigation | Props (inline) | `src/components/NotebookGuide.tsx` |

### Data Bridge: Jekyll â†’ React

Jekyll plugins generate **static JSON endpoints** at build time, which React islands fetch to hydrate their state:

```yaml
# Build-time generated files
/graph.json       # Full node/edge graph (generated by bidirectional_links_generator.rb)
/search.json      # Lightweight search index (generated by Liquid template)
```

**Data Flow:**

```
Jekyll Build
    â”œâ”€> _plugins/bidirectional_links_generator.rb
    â”‚       â””â”€> Generates _includes/notes_graph.json
    â”‚           â””â”€> Exposed as /graph.json endpoint
    â”‚
    â””â”€> search.json (Liquid template)
        â””â”€> Iterates over site.notes + site.projects
            â””â”€> Creates search index with title/url/tags

React Hydration
    â”œâ”€> GraphView fetches /graph.json
    â”‚       â””â”€> Renders D3 force-directed graph
    â”‚
    â””â”€> SearchCmdK fetches /search.json
        â””â”€> Powers fuzzy search with Fuse.js
```

### Island Mounting System

**How Islands Work** (`src/main.tsx`):

1. **Component Registration**: All island components are registered in a lookup object
   ```typescript
   const components = {
     HelloGarden,
     GraphView,
     SearchCmdK,
     VideoPlayer,
     NotesGrid,
     AudioPlayer,
     NotebookGuide,
   };
   ```

2. **Discovery**: On page load, the system scans for `[data-island]` elements
   ```typescript
   const islands = document.querySelectorAll('[data-island]');
   ```

3. **Props Parsing**: Each island can receive JSON props via `data-props` attribute
   ```typescript
   const propsAttr = container.getAttribute('data-props');
   const props = JSON.parse(propsAttr);
   ```

4. **Hydration**: React creates a root for each island and renders the component
   ```typescript
   const root = createRoot(container);
   root.render(<Component {...props} />);
   ```

**Example Usage in Jekyll Templates:**

```html
<!-- Simple island (no props) -->
<div data-island="SearchCmdK"></div>

<!-- Island with props -->
<div data-island="VideoPlayer"
     data-props='{"src": "/assets/video.mp4", "autoplay": false}'></div>
```

## ğŸš€ Quick Start

### Prerequisites
*   **Ruby 3.3+** (managed via RVM with gemset `b08xgithubio`)
*   **Node.js 20+**
*   **Bundler** for Ruby dependencies
*   **npm** for JavaScript dependencies

### Development (Unified)

The development workflow runs **two parallel processes**:

```bash
npm run dev
```

**What this does:**

| Process | Command | Output |
|---------|---------|--------|
| Jekyll Server | `bundle exec jekyll serve --incremental --livereload` | `http://localhost:4000` |
| React Watcher | `esbuild src/main.tsx --watch` | `assets/js/dist/garden-widgets.js` |

**Development Features:**
- **Incremental builds**: Jekyll only rebuilds changed files
- **LiveReload**: Browser auto-refreshes on file changes (port `35729`)
- **Hot module replacement**: esbuild rebuilds React bundle on save
- **Source maps**: Enabled for debugging React components

### Production Build

```bash
npm run build
```

**Build Pipeline:**

```
npm run build
â”œâ”€> npm run build:js
â”‚   â””â”€> esbuild src/main.tsx --bundle --minify --sourcemap
â”‚       â””â”€> Output: assets/js/dist/garden-widgets.js (optimized)
â”‚
â””â”€> bundle exec jekyll build
    â”œâ”€> Sass Compilation (_sass/ â†’ _site/assets/css/)
    â”œâ”€> PostCSS Processing (Tailwind v4 â†’ autoprefixer)
    â”œâ”€> Jekyll Plugin Execution
    â”‚   â”œâ”€> bidirectional_links_generator.rb (creates graph data)
    â”‚   â”œâ”€> obsidian_callouts.rb (converts callout syntax)
    â”‚   â”œâ”€> empty_front_matter_note_injector.rb (adds YAML)
    â”‚   â””â”€> last_modified_at_generator.rb (tracks Git dates)
    â”‚
    â””â”€> Static Site Output (_site/)

## ğŸ¨ Theme & Design System

### Aesthetic: "Cyber-Brutalist Terminal"

**Typography:**
- **UI/Code:** `JetBrains Mono` (monospace)
- **Prose:** `Inter` (variable font for optimal rendering)

**Color System:**

The theme uses **CSS custom properties** defined in `_sass/_theme-variables.scss`:

```scss
:root {
  --background: #0a0a0a;       // True black
  --foreground: #e5e5e5;       // Off-white text
  --accent: #ff6600;           // Orange accent
  --border: #333333;           // Subtle borders
  --code-bg: #1a1a1a;          // Code block background
}

[data-theme="light"] {
  --background: #ffffff;
  --foreground: #1a1a1a;
  --accent: #ff6600;           // Accent stays consistent
  --border: #e5e5e5;
  --code-bg: #f5f5f5;
}
```

**Theme Manager** (`assets/js/theme-manager.js`):
- Persists theme choice to `localStorage['theme']`
- Applies theme **before first paint** to prevent FOUC (Flash of Unstyled Content)
- Initialized in `<head>` before `<body>` renders
- Toggle button in `_includes/theme-toggle-button.html`

### Tailwind CSS v4 Integration

**Configuration** (`tailwind.config.js`):

```javascript
content: [
  './_layouts/**/*.html',
  './_includes/**/*.html',
  './src/**/*.{ts,tsx}',        // React components
  './_notes/**/*.md',            // Markdown content
]
```

**Build Pipeline:**

```
1. Sass Compilation (_sass/ â†’ CSS)
   â””â”€> Loads theme variables as CSS custom properties

2. PostCSS Processing (postcss.config.js)
   â”œâ”€> @tailwindcss/postcss   (Tailwind v4 engine)
   â”œâ”€> @tailwindcss/typography (Prose styling)
   â””â”€> autoprefixer           (Browser prefixes)

3. Jekyll Build
   â””â”€> Outputs to _site/assets/css/main.css
```

**Why Tailwind v4?**
- **Native CSS variable support** for theming
- **Smaller bundle size** with oxide engine
- **Better DX** with zero-config setup
- **PostCSS-only** pipeline (no JIT compilation needed)

## âœ¨ Features

### Interactive (React Islands)
*   **Knowledge Graph:** Zoomable D3.js force-directed graph visualizing note connections
*   **Command Palette (`Cmd+K`):** Instant fuzzy search across all notes and projects
*   **Video/Audio Players:** Custom media components with controls
*   **Notes Grid:** Filterable, sortable grid view for content discovery

### Core (Jekyll)
*   **Bidirectional Linking:** `[[Note Title]]` syntax with automatic backlink detection
*   **Obsidian Callouts:** Support for `> [!NOTE]`, `> [!WARNING]`, etc. blocks
*   **Smart TOC:** Intersection Observer-based table of contents
*   **Code Copy:** Automatic copy buttons for all code blocks
*   **Jupyter Notebook Support:** Render `.ipynb` files with preserved outputs

## ğŸ”— Bidirectional Linking System

### How It Works

The bidirectional linking system is powered by `_plugins/bidirectional_links_generator.rb` (111 lines), which runs during the Jekyll build process.

**Algorithm Overview:**

```
For each note/page in the site:
  For each other note/page:
    1. Extract potential link targets (filename + title from front matter)
    2. Create regex patterns for matching
    3. Replace [[wiki-style]] links with HTML <a> tags
    4. Track which notes link to which (build graph edges)
  5. Convert remaining [[broken links]] to styled spans
  6. Generate backlinks (reverse references)
  7. Write graph.json for React visualization
```

**Link Syntax Supported:**

| Syntax | Result | Example |
|--------|--------|---------|
| `[[Note Title]]` | Links using page title | `[[Ruby Metaprogramming]]` â†’ Link to note with title "Ruby Metaprogramming" |
| `[[filename]]` | Links using filename | `[[ruby-metaprogramming]]` â†’ Same note, different syntax |
| `[[Note Title\|custom]]` | Custom link label | `[[Ruby Metaprogramming\|learn more]]` â†’ "learn more" |
| `[[broken-link]]` | Invalid link (styled) | `[[Non-existent]]` â†’ Grayed out with brackets visible |

**Link Resolution Priority:**

1. **Exact title match** from front matter (`title:` field)
2. **Filename match** (case-insensitive, handles spaces/dashes)
3. **Fallback to invalid link** (if no match found)

### Graph Data Generation

The plugin generates `_includes/notes_graph.json` with this structure:

```json
{
  "nodes": [
    {
      "id": "1149711711798...",  // Byte encoding of title
      "path": "/note-slug",
      "label": "Note Title"
    }
  ],
  "edges": [
    {
      "source": "note-1-id",
      "target": "note-2-id"
    }
  ]
}
```

**Performance Consideration:** This plugin has **O(nÂ²) time complexity** (all notes Ã— all notes), which means build time increases quadratically. For gardens with 100+ notes, consider optimizing with caching or incremental builds.

### Backlinks

Every note automatically receives a `backlinks` data attribute containing all notes that link to it:

```liquid
{% for backlink in page.backlinks %}
  <a href="{{ backlink.url }}">{{ backlink.title }}</a>
{% endfor %}
```

This powers the "Referenced by" section in the `terminal-note.html` layout (_layouts/terminal-note.html:67).

## ğŸ“‚ Directory Structure

```
b08x.github.io/
â”œâ”€â”€ _notes/                      # Digital garden content (Markdown)
â”‚   â””â”€â”€ *.md                     # Notes with [[wiki-links]]
â”‚
â”œâ”€â”€ _projects/                   # Project showcase entries
â”‚   â””â”€â”€ *.md                     # Project descriptions
â”‚
â”œâ”€â”€ _layouts/                    # Jekyll HTML templates
â”‚   â”œâ”€â”€ default.html             # Base layout (loads React bundle)
â”‚   â”œâ”€â”€ terminal-note.html       # Main reading layout
â”‚   â”œâ”€â”€ collapsible-sidebar.html # Sidebar with TOC
â”‚   â”œâ”€â”€ notebook.html            # Jupyter notebook rendering
â”‚   â””â”€â”€ wiki.html                # Wiki-style layout
â”‚
â”œâ”€â”€ _includes/                   # Reusable Jekyll partials
â”‚   â”œâ”€â”€ head.html                # <head> metadata & theme init
â”‚   â”œâ”€â”€ nav.html                 # Navigation bar
â”‚   â”œâ”€â”€ footer.html              # Site footer
â”‚   â”œâ”€â”€ notes_graph.json         # Generated graph data (by plugin)
â”‚   â””â”€â”€ theme-toggle-button.html # Dark/light mode switch
â”‚
â”œâ”€â”€ _plugins/                    # Custom Jekyll plugins (Ruby)
â”‚   â”œâ”€â”€ bidirectional_links_generator.rb  # Core linking system (111 lines)
â”‚   â”œâ”€â”€ obsidian_callouts.rb     # Callout block converter (47 lines)
â”‚   â”œâ”€â”€ empty_front_matter_note_injector.rb # Auto-add YAML
â”‚   â”œâ”€â”€ last_modified_at_generator.rb # Git-based edit dates
â”‚   â””â”€â”€ markdown-highlighter.rb  # Syntax highlighting with Rouge
â”‚
â”œâ”€â”€ _sass/                       # Sass partials
â”‚   â”œâ”€â”€ _theme-variables.scss    # CSS custom properties (colors, fonts)
â”‚   â”œâ”€â”€ _callouts.scss           # Obsidian-style callout blocks
â”‚   â””â”€â”€ _code.scss               # Code block styling
â”‚
â”œâ”€â”€ src/                         # React source code (TypeScript)
â”‚   â”œâ”€â”€ components/              # Island components
â”‚   â”‚   â”œâ”€â”€ GraphView.tsx        # D3.js knowledge graph
â”‚   â”‚   â”œâ”€â”€ SearchCmdK.tsx       # Cmd+K search palette
â”‚   â”‚   â”œâ”€â”€ VideoPlayer.tsx      # Custom video player
â”‚   â”‚   â”œâ”€â”€ AudioPlayer.tsx      # Audio playback
â”‚   â”‚   â”œâ”€â”€ NotesGrid.tsx        # Grid view of notes
â”‚   â”‚   â””â”€â”€ NotebookGuide.tsx    # Jupyter navigation
â”‚   â””â”€â”€ main.tsx                 # Island mount logic & registry
â”‚
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ tailwind.css         # Tailwind v4 input file
â”‚   â””â”€â”€ js/
â”‚       â”œâ”€â”€ dist/
â”‚       â”‚   â””â”€â”€ garden-widgets.js # Compiled React bundle (git-tracked)
â”‚       â”œâ”€â”€ theme-manager.js     # Dark/light theme logic
â”‚       â””â”€â”€ collapsible-sidebar.js # Sidebar behavior
â”‚
â”œâ”€â”€ _site/                       # Jekyll build output (git-ignored)
â”‚
â”œâ”€â”€ graph.json                   # Jekyll template â†’ /graph.json endpoint
â”œâ”€â”€ search.json                  # Jekyll template â†’ /search.json endpoint
â”‚
â”œâ”€â”€ _config.yml                  # Jekyll configuration
â”œâ”€â”€ tailwind.config.js           # Tailwind v4 config
â”œâ”€â”€ postcss.config.js            # PostCSS pipeline
â”œâ”€â”€ tsconfig.json                # TypeScript config
â”œâ”€â”€ package.json                 # Node dependencies & build scripts
â””â”€â”€ Gemfile                      # Ruby dependencies
```

**Key Files:**

| File | Purpose | Used By |
|------|---------|---------|
| `src/main.tsx` | React island registry & mounting | Browser (client-side) |
| `_plugins/bidirectional_links_generator.rb` | Converts `[[links]]` to HTML, generates graph | Jekyll build |
| `_layouts/default.html` | Base template that loads React bundle | All pages |
| `_includes/notes_graph.json` | Graph data (nodes/edges) | GraphView island |
| `search.json` | Search index template | SearchCmdK island |
| `tailwind.config.js` | Scans `_layouts/`, `_includes/`, `src/` | PostCSS build |

## ğŸ› ï¸ Adding New Islands

**Step-by-step guide to creating a new React island:**

1.  **Create the component** in `src/components/MyWidget.tsx`:
    ```typescript
    import React from 'react';

    interface MyWidgetProps {
      title: string;
      count?: number;
    }

    export default function MyWidget({ title, count = 0 }: MyWidgetProps) {
      return (
        <div className="p-4 border border-accent">
          <h2>{title}</h2>
          <p>Count: {count}</p>
        </div>
      );
    }
    ```

2.  **Register it** in `src/main.tsx`:
    ```typescript
    import MyWidget from './components/MyWidget';

    const components = {
      HelloGarden,
      GraphView,
      SearchCmdK,
      MyWidget,  // Add your component here
    };
    ```

3.  **Embed it** in any Jekyll template (`_layouts/*.html` or `_includes/*.html`):
    ```html
    <div data-island="MyWidget"
         data-props='{"title": "Hello", "count": 42}'></div>
    ```

4.  **Rebuild** the React bundle:
    ```bash
    npm run build:js
    # Or for development with hot reload:
    npm run watch:js
    ```

**Best Practices:**
- Keep islands **small and focused** (single responsibility)
- Fetch data from Jekyll-generated JSON endpoints, not APIs
- Use TypeScript for type safety
- Lazy load components with `React.lazy()` (already configured in `main.tsx`)

## ğŸš€ Deployment

### GitHub Pages (via GitHub Actions)

The site is automatically deployed via `.github/workflows/jekyll.yml` on every push to `main`.

**Workflow Steps:**

```yaml
1. Checkout repository
2. Install system dependencies:
   - libvips-dev (image processing)
   - imagemagick (image manipulation)
   - jupyter-core, pandoc (notebook support)
3. Setup Ruby with caching
4. Setup Node.js with caching
5. Install dependencies:
   npm install && bundle install
6. Build site:
   jekyll build --baseurl "${{ base_path }}"
7. Deploy to GitHub Pages
```

**Custom Plugins Caveat:**

GitHub Pages normally runs in `--safe` mode, which disables custom plugins. This project uses **GitHub Actions** instead, which allows custom plugins to run during the build step before deployment.

### Alternative Deployment (Manual)

```bash
# Build locally
npm run build

# Output in _site/
# Deploy _site/ contents to any static host:
# - Netlify
# - Vercel
# - AWS S3 + CloudFront
# - Any web server
```

## ğŸ”§ Technical Considerations

### Performance

**Bundle Size:**
- React bundle (`garden-widgets.js`): ~150KB minified
- Lazy loading reduces initial load to <50KB
- Code splitting by island component

**Build Times:**
- Small gardens (<50 notes): <5 seconds
- Medium gardens (50-100 notes): 10-20 seconds
- Large gardens (>100 notes): 30+ seconds due to O(nÂ²) linking algorithm

**Optimizations:**
- Jekyll incremental builds (development only)
- esbuild for fast React compilation
- Tailwind v4 oxide engine for CSS
- PostCSS caching disabled (prevents stale CSS issues)

### Browser Support

**Minimum Requirements:**
- ES2020 JavaScript (esbuild target)
- CSS custom properties (theme system)
- `createRoot` API (React 19)

**Supported:**
- Chrome 88+
- Firefox 78+
- Safari 14+
- Edge 88+

### Accessibility

- Semantic HTML5 elements
- ARIA labels on interactive components
- Keyboard navigation support (`Cmd+K` for search)
- Color contrast meets WCAG AA standards
- Screen reader tested

### Security

- Content Security Policy (CSP) compatible
- No inline scripts (except theme init to prevent FOUC)
- External links open with `rel="noopener noreferrer"`
- No third-party analytics or tracking

## ğŸ› Troubleshooting

**CSS not updating?**
```bash
# Clear Jekyll cache and rebuild
rm -rf .jekyll-cache _site/
bundle exec jekyll build
```

**React islands not mounting?**
```bash
# Check browser console for errors
# Verify component name matches exactly (case-sensitive)
# Ensure data-props is valid JSON (use single quotes around attribute)
```

**Broken links after renaming notes?**
```bash
# The linking system uses both filename and front matter title
# Update both, or use git mv to preserve history
mv _notes/old-name.md _notes/new-name.md
# Then update title: in front matter
```

**Build errors in GitHub Actions?**
```bash
# Check .github/workflows/jekyll.yml
# Ensure all system dependencies are installed
# Test build locally with:
JEKYLL_ENV=production bundle exec jekyll build
```

## ğŸ“„ License

Source code is available under the [MIT license](LICENSE.md).

## ğŸ™ Acknowledgments

**Inspiration:**
- [Obsidian](https://obsidian.md/) - Bidirectional linking and callout syntax
- [Roam Research](https://roamresearch.com/) - Knowledge graph visualization
- [Astro Islands](https://docs.astro.build/en/concepts/islands/) - Island architecture pattern

**Built with:**
- [Jekyll](https://jekyllrb.com/) - Static site generator
- [React 19](https://react.dev/) - UI library
- [D3.js](https://d3js.org/) - Graph visualization
- [Tailwind CSS v4](https://tailwindcss.com/) - Utility-first CSS
- [esbuild](https://esbuild.github.io/) - JavaScript bundler